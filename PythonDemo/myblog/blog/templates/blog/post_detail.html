{% extends 'blog/base.html' %}

{% block title %}{{ post.title }} - æˆ‘çš„åšå®¢{% endblock %}

{% block content %}
<article class="post-detail">
    <header class="post-header">
        {% if post.category %}
        <a href="{% url 'blog:category_posts' post.category.slug %}" class="post-category-tag">
            {{ post.category.name }}
        </a>
        {% endif %}
        <h1 class="post-title">{{ post.title }}</h1>
        <div class="post-meta">
            <span class="meta-author">ğŸ‘¤ {{ post.author.username }}</span>
            <span class="meta-date">ğŸ“… {{ post.created_at|date:"Yå¹´mæœˆdæ—¥ H:i" }}</span>
            <span class="meta-views">ğŸ‘ {{ post.views }} æ¬¡é˜…è¯»</span>
            <span class="meta-comments">ğŸ’¬ {{ comments.count }} æ¡è¯„è®º</span>
        </div>
    </header>

    {% if post.cover_image %}
    <div class="post-cover-large" style="background-image: url('{{ post.cover_image }}')"></div>
    {% endif %}

    <div class="post-body">
        {{ post.content|linebreaks }}
    </div>

    <footer class="post-footer">
        <div class="post-tags">
            <a href="{% url 'blog:post_list' %}" class="btn btn-secondary">&larr; è¿”å›åˆ—è¡¨</a>
        </div>
    </footer>
</article>

<!-- ç›¸å…³æ–‡ç«  -->
{% if related_posts %}
<section class="related-posts">
    <h3>ç›¸å…³æ–‡ç« </h3>
    <div class="related-grid">
        {% for related in related_posts %}
        <a href="{% url 'blog:post_detail' related.slug %}" class="related-item">
            <span class="related-title">{{ related.title }}</span>
            <span class="related-date">{{ related.created_at|date:"mæœˆdæ—¥" }}</span>
        </a>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- è¯„è®ºåŒº -->
<section class="comments-section">
    <h3>è¯„è®º ({{ comments.count }})</h3>

    <!-- è¯„è®ºè¡¨å• -->
    <form action="{% url 'blog:add_comment' post.slug %}" method="post" class="comment-form">
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group">
                <label for="author_name">æ˜µç§° *</label>
                <input type="text" id="author_name" name="author_name" required placeholder="è¯·è¾“å…¥æ˜µç§°">
            </div>
            <div class="form-group">
                <label for="author_email">é‚®ç®±</label>
                <input type="email" id="author_email" name="author_email" placeholder="é€‰å¡«">
            </div>
        </div>
        <div class="form-group">
            <label for="content">è¯„è®ºå†…å®¹ *</label>
            <textarea id="content" name="content" rows="4" required placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary">å‘è¡¨è¯„è®º</button>
    </form>

    <!-- è¯„è®ºåˆ—è¡¨ -->
    <div class="comments-list">
        {% for comment in comments %}
        <div class="comment-item">
            <div class="comment-avatar">{{ comment.author_name|slice:":1" }}</div>
            <div class="comment-body">
                <div class="comment-header">
                    <span class="comment-author">{{ comment.author_name }}</span>
                    <span class="comment-date">{{ comment.created_at|date:"Y-m-d H:i" }}</span>
                </div>
                <div class="comment-content">{{ comment.content|linebreaks }}</div>
            </div>
        </div>
        {% empty %}
        <div class="empty-comments">
            <p>æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§ï¼</p>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}